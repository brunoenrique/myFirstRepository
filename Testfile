import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.util.HashSet;
import java.util.Set;

public class ConcatenarArchivosDeCarpetas {

    public static void main(String[] args) {
        // Define las rutas de las carpetas
        String carpeta1 = "ruta/a/carpeta1";
        String carpeta2 = "ruta/a/carpeta2";
        String carpetaSalida = "ruta/a/carpetaConcatenada";
        
        // Asegúrate de que la carpeta de salida existe
        File directorioSalida = new File(carpetaSalida);
        if (!directorioSalida.exists()) {
            directorioSalida.mkdirs();
        }

        concatenarArchivos(carpeta1, carpeta2, carpetaSalida);
    }

    public static void concatenarArchivos(String rutaCarpeta1, String rutaCarpeta2, String rutaCarpetaSalida) {
        File carpeta1 = new File(rutaCarpeta1);
        File carpeta2 = new File(rutaCarpeta2);
        File carpetaConcatenada = new File(rutaCarpetaSalida);

        // Obtener listas de archivos en ambas carpetas
        File[] archivosCarpeta1 = carpeta1.listFiles();
        File[] archivosCarpeta2 = carpeta2.listFiles();
        
        if (archivosCarpeta1 == null || archivosCarpeta2 == null) {
            System.err.println("Error al leer los archivos de las carpetas.");
            return;
        }

        // Guardar los nombres de los archivos de la carpeta 1
        Set<String> nombresArchivosCarpeta1 = new HashSet<>();
        for (File archivo : archivosCarpeta1) {
            if (archivo.isFile()) {
                nombresArchivosCarpeta1.add(archivo.getName());
            }
        }

        // Recorrer archivos de la carpeta 2
        for (File archivo2 : archivosCarpeta2) {
            if (archivo2.isFile()) {
                String nombreArchivo2 = archivo2.getName();
                if (nombresArchivosCarpeta1.contains(nombreArchivo2)) {
                    File archivo1 = new File(carpeta1, nombreArchivo2);
                    File archivoSalida = new File(carpetaConcatenada, nombreArchivo2);
                    concatenarArchivo(archivo1, archivo2, archivoSalida);
                }
            }
        }
    }

    private static void concatenarArchivo(File archivo1, File archivo2, File archivoSalida) {
        try (
            BufferedReader lector1 = new BufferedReader(new FileReader(archivo1));
            BufferedReader lector2 = new BufferedReader(new FileReader(archivo2));
            BufferedWriter escritor = new BufferedWriter(new FileWriter(archivoSalida))
        ) {
            // Leer y escribir el primer archivo
            String linea;
            while ((linea = lector1.readLine()) != null) {
                escritor.write(linea);
                escritor.newLine(); // Añadir salto de línea entre líneas
            }

            // Leer y escribir el segundo archivo
            while ((linea = lector2.readLine()) != null) {
                escritor.write(linea);
                escritor.newLine(); // Añadir salto de línea entre líneas
            }

            System.out.println("Los archivos " + archivo1.getName() + " y " + archivo2.getName() + " se han concatenado en " + archivoSalida.getAbsolutePath());

        } catch (IOException e) {
            System.err.println("Error al manejar los archivos: " + e.getMessage());
        }
    }
}
